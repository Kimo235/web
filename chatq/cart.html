<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TischMadeCH - Warenkorb</title>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="script.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container topbar">
      <div class="brand"><a href="index.html">Tisch<br>Made<br>CH</a></div>
      <nav>
        <ul class="nav-links">
          <li><a href="products.html">Kollektionen</a></li>
          <li><a href="gallery.html">Galerie</a></li>
          <li><a href="werkstatt.html">Werkstatt</a></li>
          <li><a href="kontakt.html">Kontakt</a></li>
          <li><a href="cart.html" class="active">Warenkorb <span class="cart-count" data-cart-count>0</span></a></li>
        </ul>
      </nav>
      <button class="burger" id="burger" aria-label="Menue oeffnen">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="mobile-menu" id="mobile-menu">
      <a href="products.html">Kollektionen</a>
      <a href="gallery.html">Galerie</a>
      <a href="werkstatt.html">Werkstatt</a>
      <a href="kontakt.html">Kontakt</a>
      <a href="cart.html">Warenkorb</a>
    </div>
  </header>

  <!-- Warenkorb -->
  <main class="container">
    <h1>Warenkorb</h1>
    <p>Ueberpruefe deine Auswahl und gehe dann zur Kasse.</p>

    <div id="cart-container" class="cart-container">
      <!-- Wird per JS befuellt -->
    </div>

    <div class="cart-summary">
      <strong>Gesamtsumme: </strong><span id="cart-total">CHF 0.00</span>
    </div>

    <div class="cart-actions">
      <a href="products.html" class="btn">Weiter einkaufen</a>
      <button id="checkout" class="btn">Zur Kasse</button>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="container footer-content">
      <div class="brand">TischMadeCH</div>
      <p>Ueberpruefe deine Auswahl und gehe dann zur Kasse.</p>
    </div>
  </footer>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const fallbackFormatter = value => `CHF ${(Number(value) || 0).toFixed(2)}`;
      const cartStore = window.TischMadeCart || {
        read: () => [],
        write: items => items,
        update: () => {},
        format: fallbackFormatter
      };

      let cart = Array.isArray(cartStore.read()) ? cartStore.read() : [];
      const cartContainer = document.getElementById('cart-container');
      const cartTotal = document.getElementById('cart-total');
      const checkoutButton = document.getElementById('checkout');

      const formatCurrency = value => (
        typeof cartStore.format === 'function'
          ? cartStore.format(value)
          : fallbackFormatter(value)
      );

      const renderCart = () => {
        if (!cartContainer) {
          return;
        }

        if (!cart.length) {
          cartContainer.innerHTML = '<p>Dein Warenkorb ist leer.</p>';
          cartTotal.textContent = formatCurrency(0);
          return;
        }

        let total = 0;

        const markup = cart.map((item, index) => {
          const unitPrice = Number(item?.price) || 0;
          const quantity = Number(item?.qty) || 0;
          const lineTotal = unitPrice * quantity;
          total += lineTotal;

          return `
            <article class="cart-item" data-index="${index}">
              <div class="item-info">
                <img src="${item?.img || ''}" alt="${item?.title || 'Produkt'}" loading="lazy" />
                <div>
                  <h3>${item?.title || 'Produkt'}</h3>
                  <p class="cart-item-price">${formatCurrency(unitPrice)}</p>
                  <p class="cart-item-total">Zwischensumme: ${formatCurrency(lineTotal)}</p>
                </div>
              </div>
              <div class="item-actions">
                <div class="qty-control" aria-label="Menge anpassen">
                  <button type="button" data-action="qty" data-step="-1" aria-label="Menge verringern">-</button>
                  <span aria-live="polite">${quantity}</span>
                  <button type="button" data-action="qty" data-step="1" aria-label="Menge erhoehen">+</button>
                </div>
                <button type="button" class="remove" data-action="remove">Entfernen</button>
              </div>
            </article>
          `;
        }).join('');

        cartContainer.innerHTML = markup;
        cartTotal.textContent = formatCurrency(total);
      };

      const commitCart = () => {
        cartStore.write(cart);
        cartStore.update();
      };

      const refreshCart = () => {
        cart = Array.isArray(cartStore.read()) ? cartStore.read() : [];
        renderCart();
      };

      const adjustQuantity = (index, step) => {
        const item = cart[index];
        if (!item) {
          return;
        }

        const currentQty = Number(item.qty) || 0;
        const nextQty = currentQty + step;

        if (nextQty <= 0) {
          cart.splice(index, 1);
        } else {
          item.qty = nextQty;
        }

        commitCart();
        refreshCart();
      };

      const removeItem = index => {
        cart.splice(index, 1);
        commitCart();
        refreshCart();
      };

      if (cartContainer) {
        cartContainer.addEventListener('click', event => {
          const button = event.target.closest('button[data-action]');
          if (!button) {
            return;
          }

          const wrapper = button.closest('[data-index]');
          const index = wrapper ? Number(wrapper.dataset.index) : NaN;
          if (!Number.isFinite(index)) {
            return;
          }

          if (button.dataset.action === 'qty') {
            adjustQuantity(index, Number(button.dataset.step) || 0);
          } else if (button.dataset.action === 'remove') {
            removeItem(index);
          }
        });
      }

      if (checkoutButton) {
        checkoutButton.addEventListener('click', () => {
          if (!cart.length) {
            alert('Dein Warenkorb ist leer.');
            return;
          }

          alert('Checkout-Demo: Hier wuerdest du den Zahlungsprozess starten.');
        });
      }

      renderCart();
    });
  </script>
</body>
</html>














